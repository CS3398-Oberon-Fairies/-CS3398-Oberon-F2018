<!DOCTYPE html>
<html>
<head> 
        
    <title>Priority Parking</title>
        
    <link href="css/style.css" type="text/css" rel="stylesheet">
    <link href="css/leaflet.css" type="text/css" rel="stylesheet">
        
    <script type='text/javascript' src='js/jquery-3.3.1.min.js'></script>
    <script type='text/javascript' src='js/leaflet.js'></script>
        
              
</head>
<body>
        
    <div class="wrapper">
        
    <!-- Title -->
        <div class="heading">
            <h1>Priority Parking</h1>
        </div>
        
    <!-- Description -->
        <div class="description">
            Our goal is to help students, teachers, and other individuals find parking in an easier and more efficient manner.
        </div>
        
    <!-- Report Status Button -->
        <div class="btn-wrapper">
            <div class= "btn-group">
                <form>
                    <input type="lotName" placeholder="Parkinglot Name" id="lotName">
                    <input type="button" onclick="full()" value="Lot is full">
                    <input type="button" onclick="notFull()" value="Lot is not full"><br>
                    <input type="button" onclick="checkStatus()" value="Check lot status">
                    <p id="result"></p>
                </form>
            </div>
        </div> 
        
    <!-- Report Status Script -->
        <script type="text/javascript" src="../front-end/js/jquery-3.3.1.min.js"></script> 
        <script>
            function full() {
                var token = sessionStorage.getItem("userToken");
                
                var ln = document.getElementById("lotName").value;
                document.getElementById("lotName").innerHTML = ln;    
                
                $.ajax("http://127.0.0.1:5000/report/report", {
                    "method": "POST",
                    "data": {"lotName":ln, "lot_status":"full", "token": token},
                    "success": function(data){
                        console.log("ATTEMPTED REPORT FULL");
                        console.log(data);
                    }
                });
            }
        </script>
        
        <script type="text/javascript" src="../front-end/js/jquery-3.3.1.min.js"></script> 
        <script>
            
            function notFull() {
                var token = sessionStorage.getItem("userToken");
                
                var ln = document.getElementById("lotName").value;    
                
                $.ajax("http://127.0.0.1:5000/report/report", {
                    "method": "POST",
                    "data": {"lotName": ln, "lot_status": "not full", "token": token},
                    "success": function(data){
                        console.log("ATTEMPTED REPORT NOT FULL");
                        console.log(data);
                    }
                });
            }
            
        </script>
        
        <script type="text/javascript" src="../front-end/js/jquery-3.3.1.min.js"></script> 
        <script>
            
            function checkStatus() {
                var ln = document.getElementById("lotName").value; 
                
                
                $.ajax("http://127.0.0.1:5000/report/checkStatus", {
                    "method": "POST",
                    "data": {"lotName":ln},
                    "success": function(data){
                        console.log("ATTEMPTED STATUS CHECK");
                        console.log(data);
                        var status = data["lot_status"];
                    }
                });
                
                document.getElementById("result").innerHTML = "Parking lot " + ln + " is " + status + "...";
                
            }
        </script>     
        
    <!-- Leaflet Map -->
        <div id="map">
        </div>
    
    <!-- Leaflet Map Script -->
        <script>            
            
            var mylat = '29.8833';
            var mylong = '-97.9414';
            var myzoom = '13';
            var map = L.map('map').setView([mylat, mylong], myzoom);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	           maxZoom: 17,
	           attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            function showMarker(poi, ae){
	           L.marker([poi[ae["Latitude"]], poi[ae["Longitude"]]]).addTo(map);
	           L.marker([poi[ae["Latitude"]], poi[ae["Longitude"]]]).addTo(map).bindPopup(poi[ae["LotName"]]);
            }

            $.getJSON("http://localhost:5000/location/search/" + mylat + "," + mylong, function(data){
	           var alias_encoding = {};
	           for(var it = 0; it < data.alias.length; it++) alias_encoding[data.alias[it]] = it;
	           for(var it = 0; it < data.result.length; it++) showMarker(data.result[it], alias_encoding)
            });
            
        </script>

    <!-- Footer -->
        <div class="footer">
            Team Oberon Fairies
        </div>
        
        
    </div>

</body>
</html>